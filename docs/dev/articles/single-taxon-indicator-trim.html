<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fbi">
<title>Single-taxon indicator (trim) • fbi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Single-taxon indicator (trim)">
<meta property="og:description" content="fbi">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fbi</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.11.7.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/overview.html">Overview</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../../__docs__/#overview">API</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/configuration.html">Configuration</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-indicators">Indicators</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-indicators">
    <a class="dropdown-item" href="../articles/winter-birds.html">Winter Birds</a>
    <a class="dropdown-item" href="../articles/alpine-birds.html">Alpine Birds</a>
    <a class="dropdown-item" href="../articles/farmland-birds.html">Farmland Birds</a>
    <a class="dropdown-item" href="../articles/forest-birds.html">Forest Birds</a>
    <a class="dropdown-item" href="../articles/mire-birds.html">Mire Birds</a>
    <a class="dropdown-item" href="../articles/moths.html">Moths</a>
    <a class="dropdown-item" href="../articles/farmland-butterflies.html">Farmland Butterflies</a>
    <a class="dropdown-item" href="../articles/butterfly-abundance.html">Butterfly Overall Abundance</a>
    <a class="dropdown-item" href="../articles/community-temperature-indices.html">Community Temperature Indices</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-code-demos">Code Demos</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-code-demos">
    <a class="dropdown-item" href="../articles/single-taxon-indicator-trim.html">Single-taxon indicator (trim)</a>
    <a class="dropdown-item" href="../articles/single-taxon-indicator-rbms.html">Single-taxon indicator (rbms)</a>
    <a class="dropdown-item" href="../articles/multi-taxon-indicator-trim.html">Multi-taxon indicator (trim)</a>
    <a class="dropdown-item" href="../articles/community-temperature-index.html">Community temperature index</a>
    <a class="dropdown-item" href="../articles/overall-abundance.html">Overall abundance</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Function Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/luomus/fin-biodiv-indicators/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Single-taxon indicator (trim)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/luomus/fin-biodiv-indicators/blob/dev/pkg/vignettes/single-taxon-indicator-trim.Rmd" class="external-link"><code>vignettes/single-taxon-indicator-trim.Rmd</code></a></small>
      <div class="d-none name"><code>single-taxon-indicator-trim.Rmd</code></div>
    </div>

    
    
<p>This documents outlines how a single-taxon indicator (<em>Anthus
pratensis</em> breeding on farmland) can be calculated in R using the
TRIM method.</p>
<div class="section level3">
<h3 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h3>
<p>The following packages are required. All packages are available on <a href="https://cran.r-project.org/" class="external-link">CRAN</a> apart from
<a href="https://github.com/luomus/fin-biodiv-indicators" class="external-link">fbi</a> which can be installed from GitHub.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/luomus/fin-biodiv-indicators" class="external-link">fbi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/luomus/finbif" class="external-link">finbif</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/markvanderloo/rtrim" class="external-link">rtrim</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="survey-data">Survey data<a class="anchor" aria-label="anchor" href="#survey-data"></a>
</h3>
<p>These five fields are required for the survey data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"document_id"</span>, <span class="st">"location_id"</span>, <span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span><span class="op">)</span></span></code></pre></div>
<p>These filters restrict the survey data to the “Point count” and “Line
transect” bird monitoring datasets from 1979 onwards at sites labelled
“farmland” and where the selected data fields have no missing data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  location_tag <span class="op">=</span> <span class="st">"farmland"</span>,</span>
<span>  collection <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Point counts of breeding terrestrial birds"</span>,</span>
<span>    <span class="st">"Line transect censuses of breeding birds"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  date_range_ymd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1979-01-01"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>  has_value <span class="op">=</span> <span class="va">select</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The survey data can now downloaded from FinBIF.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://luomus.github.io/finbif/reference/finbif_occurrence.html" class="external-link">finbif_occurrence</a></span><span class="op">(</span></span>
<span>  filter <span class="op">=</span> <span class="va">filter</span>,</span>
<span>  select <span class="op">=</span> <span class="va">select</span>,</span>
<span>  aggregate <span class="op">=</span> <span class="st">"events"</span>,</span>
<span>  aggregate_counts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Two processing functions are applied to the survey data to first
limit each site to the first survey of the year and then limit the
surveys to sites where at least two years have been surveyed.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pick_first_survey_in_year.html">pick_first_survey_in_year</a></span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/require_two_years.html">require_two_years</a></span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="count-data">Count data<a class="anchor" aria-label="anchor" href="#count-data"></a>
</h3>
<p>Count data only requires two fields to be selected: the survey
identifier (<code>document_id</code>) and the measure of abundance (in
this case the number of breeding pairs:
<code>pair_abundance</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"document_id"</span>, abundance <span class="op">=</span> <span class="st">"pair_abundance"</span><span class="op">)</span></span></code></pre></div>
<p>The count data requires the same filters as the survey data (though
the filter <code>has_value</code> needs to be redefined).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filter</span><span class="op">[[</span><span class="st">"has_value"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">select</span></span></code></pre></div>
<p>The count data for <em>Anthus pratensis</em> (Meadow pipit) can now
be downloaded from FinBIF.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://luomus.github.io/finbif/reference/finbif_occurrence.html" class="external-link">finbif_occurrence</a></span><span class="op">(</span></span>
<span>  taxa <span class="op">=</span> <span class="st">"Anthus pratensis"</span>,</span>
<span>  filter <span class="op">=</span> <span class="va">filter</span>,</span>
<span>  select <span class="op">=</span> <span class="va">select</span>,</span>
<span>  n <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Three processing functions are applied to the count data to: infill
the count data with zero occurrences using the survey data; sum over the
counts for each site-year combination; and remove all sites where the
number of breeding pairs was zero on every occasion.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zero_fill.html">zero_fill</a></span><span class="op">(</span><span class="va">counts</span>, <span class="va">surveys</span><span class="op">)</span></span>
<span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sum_by_event.html">sum_by_event</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span>
<span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_all_zero_locations.html">remove_all_zero_locations</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-trim-model">Fit TRIM Model<a class="anchor" aria-label="anchor" href="#fit-trim-model"></a>
</h2>
<p>A TRIM model is used to estimate the change in abundance over
time.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtrim/man/trim.html" class="external-link">trim</a></span><span class="op">(</span><span class="va">abundance</span> <span class="op">~</span> <span class="va">location_id</span> <span class="op">+</span> <span class="va">year</span>, <span class="va">counts</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-index">Create Index<a class="anchor" aria-label="anchor" href="#create-index"></a>
</h2>
<p>An index of change in relative abundance is created by setting the
base year to the year 2000.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtrim/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">model</span>, base <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html" class="external-link">parse_date_time</a></span><span class="op">(</span><span class="va">time</span>, <span class="st">"Y"</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">imputed</span>,</span>
<span>  ymin <span class="op">=</span> <span class="va">imputed</span> <span class="op">-</span> <span class="va">se_imp</span>, ymax <span class="op">=</span> <span class="va">imputed</span> <span class="op">+</span> <span class="va">se_imp</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figure/plot-single-taxon-trim-1.png" alt="Relative abundance of Meadow pipit breeding pairs on Farmland in Finland (calculated using rTRIM)"><div class="figcaption">Relative abundance of Meadow pipit breeding
pairs on Farmland in Finland (calculated using rTRIM)</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by William K. Morris.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
